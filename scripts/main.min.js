function alignedPower(e,t,r,n,a,o,i,c,l){o=parseInt(o),i=parseInt(i),c=parseInt(c),o=calcAttribute(e,r,o),i>0&&(i=calcAttribute(e,n,i)),c&&(c=calcAttribute(e,a,c));var s=o+i+c;t=parseInt(t),l=parseInt(l);var u=(s+1)*t+l;return u}function unalignedPower(e,t=0,r=0,n=0,a=0){t=parseInt(t),r=parseInt(r),n=parseInt(n),e=parseInt(e),a=parseInt(a);var o=t+r+n,i=(.0025*o+1)*e+a;return i}function calcAttribute(e,t,r){return t!=e?.0025*r:"NEUTRAL"==t?.002575*r:t==e?.002675*r:void 0}function elementBonus(e,t,r){var n=1;return e==t&&(n+=.075),"FIRE"==e&&"EARTH"==r&&(n+=.075),"FIRE"==e&&"WATER"==r&&(n-=.075),"EARTH"==e&&"AIR"==r&&(n+=.075),"EARTH"==e&&"FIRE"==r&&(n-=.075),"AIR"==e&&"WATER"==r&&(n+=.075),"AIR"==e&&"EARTH"==r&&(n-=.075),"WATER"==e&&"FIRE"==r&&(n+=.075),"WATER"==e&&"AIR"==r&&(n-=.075),n}function finalPowerValue(e,t=0,r,n,a,o,i=0,c=0,l=0,s=0,u){var p=alignedPower(e,t,n,a,o,i,c,l,s),f=elementBonus(e,r,u),b=p*f;return[.9*b,1.1*b]}async function start(){try{var e,t,r,n=!0;n&&"true"===n&&(e="https://graph.bunicorn.exchange/subgraphs/name/bunicorndefi/buni-token",n={query:'query { tokenPrice (id: "0x0e7beec376099429b85639eb3abe7cf22694ed49") { price } }'},n=JSON.stringify(n),(t=await new Promise(function(t,r){$.ajax({url:e,type:"POST",data:n,contentType:"application/json"}).done(t).fail(r)}))&&t.data&&t.data.tokenPrice.price&&(r=Number.parseFloat(t.data.tokenPrice.price).toFixed(3).toString(),console.log(r),chrome.storage.sync.set({BUNI_price:r,BUNI_price_lastUpdated:(new Date).toLocaleString()})))}catch(t){console.log(t)}}async function getBUNIPrice(){var e=0,t="https://graph.bunicorn.exchange/subgraphs/name/bunicorndefi/buni-token",r={query:'query { tokenPrice (id: "0x0e7beec376099429b85639eb3abe7cf22694ed49") { price } }'};return r=JSON.stringify(r),await $.ajax({url:t,type:"POST",data:r,contentType:"application/json"}).then(t=>{t.data&&(e=Number.parseFloat(t.data.tokenPrice.price).toFixed(3))}).catch(e=>console.log("getBuniPrice error",e)),e}async function getPrice(){var e="https://graph.bunicorn.exchange/subgraphs/name/bunicorndefi/buni-token",t={query:'query { tokenPrice (id: "0x0e7beec376099429b85639eb3abe7cf22694ed49") { price } }'};t=JSON.stringify(t);var r=new Promise(function(){$.ajax({url:e,type:"POST",data:t,contentType:"application/json"}).done(r)});return r}function bunicornPowerMultiplier(e,t,r,n,a,o,i,c){const l=500;a=parseInt(a),o=parseInt(o),i=parseInt(i),c=parseInt(c),a*=factor(e,t),o>0&&(o*=factor(e,r)),i&&(i*=factor(e,n));var s=a+o+i+1.07*c;let u=1+s/l;return u}function factor(e,t){let r=1;return t===e?r=1.15:"NEUTRAL"===t&&(r=1.07),r}function playerBasePower(e,t){return e*t}function playerPower(e,t,r,n){let a=.052*e;return t===r&&(e+=a),"FIRE"==t&&"EARTH"==n&&(e+=a),"FIRE"==t&&"WATER"==n&&(e-=a),"EARTH"==t&&"AIR"==n&&(e+=a),"EARTH"==t&&"FIRE"==n&&(e-=a),"AIR"==t&&"WATER"==n&&(e+=a),"AIR"==t&&"EARTH"==n&&(e-=a),"WATER"==t&&"FIRE"==n&&(e+=a),"WATER"==t&&"AIR"==n&&(e-=a),e}function rewardUSD(e,t){e=parseInt(e);const r=0,n=.4;let a=Math.sqrt(e/1e3*t),o=r+n*a;return o.toFixed(2)}function expGain(e,t){e=parseInt(e);let r=Math.floor(e/t*32);return r}function getStar(){var e=$("#star5").prop("checked"),t=$("#star4").prop("checked"),r=$("#star3").prop("checked"),n=$("#star2").prop("checked"),a=$("#star1").prop("checked");return e?5:t?4:r?3:n?2:a?1:void 0}function winRateCalc(e,t,r,n){let a=Math.min(e,t,r,n),o=Math.max(e,t,r,n),i=o-a+1,c=0;for(let a=r;a<=n;a++)for(let r=e;r<=t;r++)r==a&&c++;let l=c/i,s=e-r,u=t-n,p=s/i,f=u/i,b=p+f+l/2;return b<=0?0:100*b}function MsgBox(e,t,r){Swal.fire({title:e,text:t,icon:r})}function Toast(e,t="info"){Swal.fire({icon:t,text:e,timer:3e3,position:"center",toast:!0,showConfirmButton:!1,timerProgressBar:!0})}function getIframeContents(){var e=document.getElementById("frame1"),t=e.contentWindow.document.getElementsByTagName("pre")[0];return t}$(document).ready(function(){getBUNIPrice()}),$("#btnCalc").on("click",function(){var e=$("#txtTrainerElement").val(),t=$("#txtTrainerPower").val(),r=$("#txtBunicornElement").val(),n=$("#txtAttribute1").val(),a=$("#txtAttribute2").val(),o=$("#txtAttribute3").val(),i=$("#txtAttribute1Val").val(),c=$("#txtAttribute2Val").val(),l=$("#txtAttribute3Val").val(),s=$("#txtBonusPower").val(),u=$("#txtEnemyElement").val();if(""!=e)if(""!=r)if(""!=n)if(""==n||""!=i)if(""==a||""!=c)if(""==a&&(c=0),""==o||""!=l)if(""==o&&(l=0),""==s&&(s=0),""!=u)if(""!=u){var p=$("#txtEnemyPower").val(),f=.9*parseInt(p),b=1.1*parseInt(p),d=0,g=bunicornPowerMultiplier(r,n,a,o,i,c,l,s),R=playerBasePower(t,g),h=playerPower(R,e,r,u),x=[.9*h,1.1*h],I=expGain(p,R),P=rewardUSD(p,getStar()),m=`<i class="bi bi-lightning-charge"></i> Your power: ${Math.floor(x[0])} ~ ${Math.floor(x[1])}`;$("#lbResult").html(m),d=winRateCalc(Math.floor(x[0]),Math.floor(x[1]),Math.floor(f),Math.floor(b)),$("#lbWinRate").html('<i class="bi bi-trophy"></i> Win rate: '+Math.floor(d)+"%"),$("#lbWinRate").prop("class","");var A=d<90?"warning":"success",y=d<90?"text-danger":"text-success";$("#lbWinRate").addClass(y),$("#lbReward").html(`Reward: ~$${P} <span style="color: #28aafd;">+${I} XP</span>`),Toast(`Win rate: ${Math.floor(d)}%`,A)}else MsgBox("Please input enemy power","","error");else MsgBox("Please select enemy element","","error");else MsgBox("Please input Bunicorn attribute 3 value","","error");else MsgBox("Please input Bunicorn attribute 2 value","","error");else MsgBox("Please input Bunicorn attribute 1 value","","error");else MsgBox("Please select Bunicorn attribute 1 element","","error");else MsgBox("Please select your Bunicorn element","","error");else MsgBox("Please select your trainer element","","error")});