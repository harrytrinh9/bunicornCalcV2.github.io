function alignedPower(e,t,r,n,a,o,l,i,s){o=parseInt(o),l=parseInt(l),i=parseInt(i),o=calcAttribute(e,r,o),l>0&&(l=calcAttribute(e,n,l)),i&&(i=calcAttribute(e,a,i));var u=o+l+i;t=parseInt(t),s=parseInt(s);var c=(u+1)*t+s;return c}function unalignedPower(e,t=0,r=0,n=0,a=0){t=parseInt(t),r=parseInt(r),n=parseInt(n),e=parseInt(e),a=parseInt(a);var o=t+r+n,l=(.0025*o+1)*e+a;return l}function calcAttribute(e,t,r){return t!=e?.0025*r:"NEUTRAL"==t?.002575*r:t==e?.002675*r:void 0}function elementBonus(e,t,r){var n=1;return e==t&&(n+=.075),"FIRE"==e&&"EARTH"==r&&(n+=.075),"FIRE"==e&&"WATER"==r&&(n-=.075),"EARTH"==e&&"AIR"==r&&(n+=.075),"EARTH"==e&&"FIRE"==r&&(n-=.075),"AIR"==e&&"WATER"==r&&(n+=.075),"AIR"==e&&"EARTH"==r&&(n-=.075),"WATER"==e&&"FIRE"==r&&(n+=.075),"WATER"==e&&"AIR"==r&&(n-=.075),n}function finalPowerValue(e,t=0,r,n,a,o,l=0,i=0,s=0,u=0,c){var f=alignedPower(e,t,n,a,o,l,i,s,u),p=elementBonus(e,r,c),R=f*p;return[.9*R,1.1*R]}function bunicornPowerMultiplier(e,t,r,n,a,o,l,i){const s=500;a=parseInt(a),o=parseInt(o),l=parseInt(l),i=parseInt(i),a*=factor(e,t),o>0&&(o*=factor(e,r)),l&&(l*=factor(e,n));var u=a+o+l+1.05*i;let c=1+u/s;return c}function factor(e,t){let r=1;return t===e?r=1.1:"NEUTRAL"===t&&(r=1.05),r}function playerBasePower(e,t){return e*t}function playerPower(e,t,r,n){let a=.065*e;return t===r&&(e+=a),"FIRE"==t&&"EARTH"==n&&(e+=a),"FIRE"==t&&"WATER"==n&&(e-=a),"EARTH"==t&&"AIR"==n&&(e+=a),"EARTH"==t&&"FIRE"==n&&(e-=a),"AIR"==t&&"WATER"==n&&(e+=a),"AIR"==t&&"EARTH"==n&&(e-=a),"WATER"==t&&"FIRE"==n&&(e+=a),"WATER"==t&&"AIR"==n&&(e-=a),e}function rewardUSD(e,t){e=parseInt(e);const r=.5,n=.5;let a=Math.sqrt(e/1e3*t),o=r+n*a;return o.toFixed(2)}function expGain(e,t){e=parseInt(e);let r=Math.floor(e/t*32);return r}function getStar(){var e=$("#star5").prop("checked"),t=$("#star4").prop("checked"),r=$("#star3").prop("checked"),n=$("#star2").prop("checked"),a=$("#star1").prop("checked");return e?5:t?4:r?3:n?2:a?1:void 0}function winRateCalc(e,t,r,n){let a=Math.min(e,t,r,n),o=Math.max(e,t,r,n),l=o-a+1,i=0;for(let a=r;a<=n;a++)for(let r=e;r<=t;r++)r==a&&i++;let s=i/l,u=e-r,c=t-n,f=u/l,p=c/l,R=f+p+s/2;return R<=0?0:100*R}function MsgBox(e,t,r){Swal.fire({title:e,text:t,icon:r})}function Toast(e,t="info"){Swal.fire({icon:t,text:e,timer:3e3,position:"center",toast:!0,showConfirmButton:!1,timerProgressBar:!0})}function getIframeContents(){var e=document.getElementById("frame1"),t=e.contentWindow.document.getElementsByTagName("pre")[0];return t}$(document).ready(function(){}),$("#btnCalc").on("click",function(){var e=$("#txtTrainerElement").val(),t=$("#txtTrainerPower").val(),r=$("#txtBunicornElement").val(),n=$("#txtAttribute1").val(),a=$("#txtAttribute2").val(),o=$("#txtAttribute3").val(),l=$("#txtAttribute1Val").val(),i=$("#txtAttribute2Val").val(),s=$("#txtAttribute3Val").val(),u=$("#txtBonusPower").val(),c=$("#txtEnemyElement").val();if(""!=e)if(""!=r)if(""!=n)if(""==n||""!=l)if(""==a||""!=i)if(""==a&&(i=0),""==o||""!=s)if(""==o&&(s=0),""==u&&(u=0),""!=c)if(""!=c){var f=$("#txtEnemyPower").val(),p=.9*parseInt(f),R=1.1*parseInt(f),A=0,I=bunicornPowerMultiplier(r,n,a,o,l,i,s,u),E=playerBasePower(t,I),m=playerPower(E,e,r,c),x=[.9*m,1.1*m],v=expGain(f,E),b=rewardUSD(f,getStar()),w=`<i class="bi bi-lightning-charge"></i> Your power: ${Math.floor(x[0])} ~ ${Math.floor(x[1])}`;$("#lbResult").html(w),A=winRateCalc(Math.floor(x[0]),Math.floor(x[1]),Math.floor(p),Math.floor(R)),$("#lbWinRate").html('<i class="bi bi-trophy"></i> Win rate: '+Math.floor(A)+"%"),$("#lbWinRate").prop("class","");var d=A<90?"warning":"success",g=A<90?"text-danger":"text-success";$("#lbWinRate").addClass(g),$("#lbReward").html(`Reward: ~$${b} <span style="color: #28aafd;">+${v} XP</span>`),Toast(`Win rate: ${Math.floor(A)}%`,d)}else MsgBox("Please input enemy power","","error");else MsgBox("Please select enemy element","","error");else MsgBox("Please input Bunicorn attribute 3 value","","error");else MsgBox("Please input Bunicorn attribute 2 value","","error");else MsgBox("Please input Bunicorn attribute 1 value","","error");else MsgBox("Please select Bunicorn attribute 1 element","","error");else MsgBox("Please select your Bunicorn element","","error");else MsgBox("Please select your trainer element","","error")});